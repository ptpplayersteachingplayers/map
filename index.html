
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PTP Trainer Matcher</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f9f9f9; }
    header { background: #111; color: white; text-align: center; padding: 40px 20px; }
    header h1 { margin: 0; font-size: 2.2rem; }
    #controls { text-align: center; padding: 20px; background: #fff; }
    #zipInput { padding: 10px; width: 220px; font-size: 16px; }
    #searchButton { padding: 10px 15px; font-size: 16px; margin-left: 8px; cursor: pointer; background-color: #FFD700; border: none; border-radius: 4px; }
    #map { width: 100%; height: 500px; }
    .trainer-list { display: flex; flex-wrap: wrap; justify-content: center; padding: 20px; }
    .trainer-card { background: white; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); margin: 10px; padding: 15px; width: 280px; line-height: 1.5; }
    .trainer-card h3 { margin: 0 0 8px; font-size: 1.2rem; }
    .trainer-card a { display: inline-block; margin-top: 8px; background: #FFD700; padding: 6px 10px; border-radius: 4px; text-decoration: none; color: black; font-weight: bold; }
  </style>
</head>
<body>
  <header>
    <h1>PTP = Players Teaching Players</h1>
    <p>Find a college/pro trainer near you ‚Äî instantly.</p>
  </header>

  <div id="controls">
    <input type="text" id="zipInput" placeholder="Enter your ZIP code" />
    <button id="searchButton" onclick="filterAndDisplay()">Find Trainers</button>
  </div>

  <div id="map"></div>
  <div class="trainer-list" id="trainerList"></div>

  <script>
    let map, trainerData = [], trainerMarkers = [];

    const fallbackTrainers = [
      { name: "Ken Roby", link: "#", zip: "19087", city: "Wayne", availability: "M‚ÄìF 9‚Äì5", lat: 40.04, lng: -75.38 },
      { name: "Lorenzo Avalos", link: "#", zip: "19010", city: "Bryn Mawr", availability: "Weekends", lat: 40.03, lng: -75.33 }
    ];

    window.initMap = function () {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 40.0, lng: -75.3 },
        zoom: 10
      });
      fetchTrainerData();
    };

    function fetchTrainerData() {
      fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vSClTYNvQo15rYGb6Au-Uxk84CxTuJ1Q5sLEhXd2ReLm0JyUbhQhOMSi1-I50hf3Rs4TArW6gmgbqfa/pub?gid=1794622671&single=true&output=csv")
        .then(res => res.text())
        .then(csv => {
          const lines = csv.split("\n").slice(1);
          trainerData = lines.map(line => {
            const [name, link, zip, city, availability] = line.split(",");
            const lat = 40 + Math.random() * 0.1 - 0.05;
            const lng = -75.3 + Math.random() * 0.1 - 0.05;
            return { name, link, zip, city, availability, lat, lng };
          }).filter(t => t.name);
          if (trainerData.length === 0) throw "No data parsed";
          displayAllTrainers(trainerData);
        })
        .catch(err => {
          console.error("Failed to load sheet. Using fallback.", err);
          trainerData = fallbackTrainers;
          displayAllTrainers(trainerData);
        });
    }

    window.filterAndDisplay = function () {
      const zip = document.getElementById("zipInput").value;
      if (zip) {
        const geocoder = new google.maps.Geocoder();
        geocoder.geocode({ address: zip }, (results, status) => {
          if (status === "OK") {
            map.setCenter(results[0].geometry.location);
            map.setZoom(12);
          }
        });
      }
      displayAllTrainers(trainerData);
    };

    function displayAllTrainers(data) {
      const list = document.getElementById("trainerList");
      list.innerHTML = "";
      trainerMarkers.forEach(m => m.setMap(null));
      trainerMarkers = [];

      data.forEach(t => {
        const card = document.createElement("div");
        card.className = "trainer-card";
        card.innerHTML = `
          <h3>${t.name}</h3>
          üìç <strong>Field:</strong> ${t.city}<br>
          üìÖ <strong>Available:</strong> ${t.availability}<br>
          <em>‚ÄúCoach ${t.name.split(' ')[0]} helped my kid level up!‚Äù</em><br>
          <a href="${t.link}" target="_blank">Book Now</a>
        `;
        list.appendChild(card);

        const marker = new google.maps.Marker({
          position: { lat: t.lat, lng: t.lng },
          map,
          title: t.name,
          icon: "https://maps.google.com/mapfiles/ms/icons/yellow-dot.png"
        });
        const info = new google.maps.InfoWindow({
          content: `<strong>${t.name}</strong><br>${t.city}<br><a href='${t.link}' target='_blank'>Book</a>`
        });
        marker.addListener("click", () => {
          info.open(map, marker);
          card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
        trainerMarkers.push(marker);
      });
    }
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyASLf8mjb8iEbVo99DnaaPzXGlu5jhXrZE&callback=initMap">
  </script>
</body>
</html>
